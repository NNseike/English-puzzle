<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>英語文法パズル（ステージ選択／5ボタン固定／正解スロット置換）</title>
  <style>
    /* リセット */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      text-align: center;
      position: relative;
      /* 紙吹雪用 */
    }

    h1 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    /* ステージ選択ボタン */
    #stage-select {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    #stage-select button {
      background-color: #007BFF;
      color: #fff;
      padding: 0.75rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      border: none;
      transition: background-color 0.2s, transform 0.1s;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
      width: 45px;
      /* ボタン幅を固定 */
      height: 45px;
      /* ボタン高さを固定 */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #stage-select button:hover {
      background-color: #0056b3;
      transform: scale(1.05);
      box-shadow: 3px 3px 7px rgba(0, 0, 0, 0.2);
    }

    #current-stage {
      margin-bottom: 1rem;
    }

    .sentence-box {
      border: 1px solid #ccc;
      padding: 1rem;
      min-height: 50px;
      background-color: #fff;
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      text-align: left;
    }

    .words {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      /* 常に5列 */
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .word {
      background-color: #007BFF;
      color: #fff;
      padding: 0.75rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      border: none;
      transition: background-color 0.2s, transform 0.1s;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
    }

    .word:hover {
      background-color: #0056b3;
      transform: scale(1.05);
      box-shadow: 3px 3px 7px rgba(0, 0, 0, 0.2);
    }

    .used-up {
      background-color: #6c757d !important;
      cursor: not-allowed;
    }

    .feedback {
      margin-top: 0.5rem;
      font-weight: bold;
      min-height: 1.5rem;
    }

    .hint-button,
    .next-button {
      display: none;
      width: 100%;
      padding: 0.75rem;
      margin-top: 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .hint-button {
      background-color: #ffc107;
      color: #333;
    }

    .hint-button:hover {
      background-color: #ffb300;
    }

    .next-button {
      background-color: #28a745;
      color: #fff;
    }

    .next-button:hover {
      background-color: #218838;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.25rem;
      }

      .sentence-box {
        font-size: 0.95rem;
      }

      .word {
        font-size: 0.85rem;
        padding: 0.5rem;
      }

      .hint-button,
      .next-button {
        font-size: 0.9rem;
      }
    }

    /* 紙吹雪 */
    .confetti {
      position: absolute;
      pointer-events: none;
      z-index: 1000;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #fce18a;
      top: 0;
      left: 0;
      opacity: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>英語文法パズル</h1>
    <div id="stage-select">
      <!-- ステージ選択ボタンはJavaScriptで動的に生成します -->
    </div>
    <h2 id="current-stage"></h2>
    <h3 id="japanese-sentence"></h3>
    <div class="sentence-box" id="sentence-box"></div>
    <div class="words" id="word-buttons"></div>
    <div class="feedback" id="feedback"></div>
    <button id="hint-button" class="hint-button">ヒント</button>
    <button id="next-button" class="next-button">次に進む</button>
  </div>
  <div class="confetti" id="confetti-container"></div>
  <script>
    const stages = [
      [
  {
    "japanese": "やあ、最近どう？",
    "english": "Hey, what's up?"
  },
  {
    "japanese": "特に変わりないよ。ちょうどジムから戻ってきたところだよ。",
    "english": "Not much. I just got back from the gym."
  },
  {
    "japanese": "また夜中に行ったの？ 毎日通ってるの？",
    "english": "Another late-night session? You really go every day?"
  },
  {
    "japanese": "うん、深夜は空いてて集中しやすいんだ。",
    "english": "Yeah, it's quiet at night, so it's easier to focus."
  },
  {
    "japanese": "そうなんだ。仕事はどうしたの？ 辞めたって聞いたけど。",
    "english": "I see. What about work? I heard you quit."
  },
  {
    "japanese": "うん、辞めちゃった。インドに行くから自由に動きたくてさ。",
    "english": "Yeah, I did. I'm going to India, so I wanted more freedom."
  },
  {
    "japanese": "いいね！ インドのどこに行くの？",
    "english": "Awesome! Where in India are you going?"
  },
  {
    "japanese": "ジャイサルメールってとこで、砂漠祭りを見に行くんだ。",
    "english": "I'm heading to Jaisalmer to see the desert festival."
  },
  {
    "japanese": "砂漠祭り？ 面白そうだね。どれくらい滞在するの？",
    "english": "A desert festival? That sounds cool. How long are you staying?"
  },
  {
    "japanese": "まだ決めてないけど、2週間くらいかな。",
    "english": "Not sure yet, maybe around two weeks."
  },
  {
    "japanese": "一人で行くの？",
    "english": "Are you going alone?"
  },
  {
    "japanese": "うん、一人旅。ちょっと不安だけど楽しみの方が大きいよ。",
    "english": "Yeah, it's a solo trip. I'm a bit nervous, but mostly excited."
  },
  {
    "japanese": "絶対いい経験になるよ。",
    "english": "It'll be an amazing experience."
  },
  {
    "japanese": "そうだね。あ、明日夕飯一緒にどう？",
    "english": "True. Hey, want to grab dinner tomorrow?"
  },
  {
    "japanese": "いいよ、どこ行く？",
    "english": "Sure, where to?"
  },
  {
    "japanese": "牛丼屋がいいかな。安いし手軽だから。",
    "english": "Maybe a beef bowl place. It's cheap and convenient."
  },
  {
    "japanese": "いいね。天丼も好きだけど、牛丼も捨てがたいよね。",
    "english": "Sounds good. I love tempura bowls too, but beef bowls are great."
  },
  {
    "japanese": "うん、今は節約したいから牛丼で十分かな。",
    "english": "Yeah, I'm trying to save money right now, so beef bowls are perfect."
  },
  {
    "japanese": "なるほど。仕事してないと出費も気になるよね。普段は何してる？",
    "english": "Makes sense. Without a job, expenses matter. What do you usually do?"
  },
  {
    "japanese": "YouTube見たり、アニメや映画を観たり、音楽聴いたりしてるよ。",
    "english": "I watch YouTube, anime, movies, and listen to music."
  },
  {
    "japanese": "ボクシングも観るんでしょ？ おすすめある？",
    "english": "You also watch boxing, right? Any recommendations?"
  },
  {
    "japanese": "最近は○○って選手にハマってる。試合が熱いんだ。",
    "english": "Lately, I'm into a boxer named ___. His matches are intense."
  },
  {
    "japanese": "面白そうだね。ちょっとチェックしてみるよ。",
    "english": "Sounds interesting. I'll check him out."
  },
  {
    "japanese": "ぜひ。結構盛り上がるから見てほしいな。",
    "english": "Sure. I'd love for you to see how exciting it is."
  },
  {
    "japanese": "ところで、ジムってどの時間帯が多いの？",
    "english": "By the way, what time do you usually go to the gym?"
  },
  {
    "japanese": "ほとんど真夜中だよ。空いてるから快適なんだ。",
    "english": "Mostly around midnight. It's empty, so it's comfortable."
  },
  {
    "japanese": "俺は朝派だけど、夜中のジムも試してみようかな。",
    "english": "I'm a morning person, but maybe I'll try a late-night workout."
  },
  {
    "japanese": "いいじゃん。もし行くなら声かけてよ。",
    "english": "That'd be cool. Let me know if you do."
  },
  {
    "japanese": "了解。ところでインドはいつ出発するの？",
    "english": "Got it. So when are you leaving for India?"
  },
  {
    "japanese": "来月くらいかな。日程はまだ調整中だけど楽しみだよ。",
    "english": "Probably next month. I'm still working out the dates, but I'm excited."
  }
],
      [
  {
    "japanese": "やあ、元気？",
    "english": "Hey, what's good?"
  },
  {
    "japanese": "うん、まあまあかな。そっちは？",
    "english": "I'm alright. How about you?"
  },
  {
    "japanese": "俺も同じようなもん。昨日はめちゃ疲れたけどね。",
    "english": "Same here. I was super tired yesterday, though."
  },
  {
    "japanese": "なんで？ 仕事が忙しかった？",
    "english": "How come? Were you swamped at work?"
  },
  {
    "japanese": "うん、残業が続いちゃってさ。終電で帰ったよ。",
    "english": "Yeah, I had some overtime. I took the last train home."
  },
  {
    "japanese": "うわ、大変だね。今日はゆっくり休めそう？",
    "english": "Dang, that's rough. Can you chill today?"
  },
  {
    "japanese": "そうだね。今日は家でのんびりして、Netflixでも見ようかな。",
    "english": "Yeah, I'm just gonna relax at home and maybe binge Netflix."
  },
  {
    "japanese": "いいね！ 俺も最近ハマってるドラマがあるんだ。",
    "english": "Nice! I'm totally hooked on a show right now, too."
  },
  {
    "japanese": "どんなドラマ？ おすすめある？",
    "english": "What kind of show is it? Any recommendations?"
  },
  {
    "japanese": "アクション系かな。ストーリーもテンポ良くて見やすいよ。",
    "english": "It's an action series. The story's fast-paced and easy to watch."
  },
  {
    "japanese": "へえ、後でタイトル教えて。チェックしてみるわ。",
    "english": "Cool, tell me the title later. I'll check it out."
  },
  {
    "japanese": "もちろん！ あ、明日の夜って予定ある？",
    "english": "Sure thing! Hey, do you have plans tomorrow night?"
  },
  {
    "japanese": "特にないけど、なんかあるの？",
    "english": "Not really. What's up?"
  },
  {
    "japanese": "一緒にバーでも行かない？ 新しくできたところがあるんだ。",
    "english": "Wanna hit up a bar? There's a new spot in town."
  },
  {
    "japanese": "いいね。どんな感じのバーなの？",
    "english": "Sounds good. What kind of bar is it?"
  },
  {
    "japanese": "結構カジュアルで、音楽もいいらしいよ。",
    "english": "It's pretty chill, and I heard the music is dope."
  },
  {
    "japanese": "おー、じゃあ行こうか。何時ごろにする？",
    "english": "Sweet, let's do it. Around what time?"
  },
  {
    "japanese": "8時くらいに行こうかなって思ってる。",
    "english": "I'm thinking maybe around 8 PM."
  },
  {
    "japanese": "了解！ じゃあ、その前に軽く何か食べておくね。",
    "english": "Gotcha! I'll grab a quick bite beforehand."
  },
  {
    "japanese": "うん、腹ごしらえは大事だからね。",
    "english": "Yeah, you gotta fuel up first."
  },
  {
    "japanese": "ところで、最近何か面白いことあった？",
    "english": "By the way, anything fun happen lately?"
  },
  {
    "japanese": "うーん、友達がペットを飼い始めてめちゃ癒されてるくらいかな。",
    "english": "Hmm, not much. A friend got a new pet, which is super cute."
  },
  {
    "japanese": "いいね！ 犬？ 猫？",
    "english": "Nice! A dog? A cat?"
  },
  {
    "japanese": "柴犬だよ。めっちゃ人懐っこくてさ。",
    "english": "It's a Shiba Inu. Super friendly."
  },
  {
    "japanese": "それは最高だね。俺も犬飼いたいけど、部屋が狭くてさ。",
    "english": "That's awesome. I'd love a dog, but my place is too small."
  },
  {
    "japanese": "確かに飼い始めるには広さが必要だよね。",
    "english": "True, you need some space if you're gonna have a dog."
  },
  {
    "japanese": "まあいつか余裕できたら検討するわ。",
    "english": "Someday, when I have more room, I'll consider it."
  },
  {
    "japanese": "お金と時間の余裕も大事だもんね。",
    "english": "Yeah, you need both money and time for a pet."
  },
  {
    "japanese": "そうそう。今は仕事が落ち着いたら旅行も行きたいしね。",
    "english": "Exactly. I also wanna travel once work settles down."
  },
  {
    "japanese": "いいね！ 行きたい場所はあるの？",
    "english": "Nice! Anywhere in mind?"
  },
  {
    "japanese": "ヨーロッパあたりをぶらぶらしたいかな。まだ妄想だけどね。",
    "english": "I'd like to wander around Europe. It's just a dream right now, though."
  },
  {
    "japanese": "夢があるのはいいことだよ。じゃあ明日バーでまた話聞かせてよ。",
    "english": "It's good to have dreams. Tell me more tomorrow at the bar."
  }
],
      [
  {
    "japanese": "やあ、元気にしてる？",
    "english": "Hey, how are you doing?"
  },
  {
    "japanese": "うん、元気だよ。君はどう？",
    "english": "I'm good. How about you?"
  },
  {
    "japanese": "僕もまあまあかな。今日は何をする予定？",
    "english": "I'm alright, too. What are you going to do today?"
  },
  {
    "japanese": "午前中は本を読んで、午後は少し勉強しようと思ってるよ。",
    "english": "I'm going to read a book in the morning and study a bit in the afternoon."
  },
  {
    "japanese": "へえ、勉強って何の勉強？ 英語？",
    "english": "Oh yeah? What are you studying? English?"
  },
  {
    "japanese": "うん、最近英会話の練習をしてるんだ。文法もちゃんとやらなきゃって思ってさ。",
    "english": "Yeah, I'm practicing English conversation lately. I realized I need to work on grammar, too."
  },
  {
    "japanese": "いいね。ところで、去年の夏休みにどこか行った？",
    "english": "Nice. By the way, did you go anywhere last summer vacation?"
  },
  {
    "japanese": "去年は旅行しなかったんだ。忙しくて時間がなかったから。",
    "english": "No, I didn't travel last year. I was busy and didn't have time."
  },
  {
    "japanese": "そっか。今年は行く予定あるの？",
    "english": "I see. Are you planning to go anywhere this year?"
  },
  {
    "japanese": "まだ決めてないけど、もし休みが取れたら海に行きたいな。",
    "english": "I haven't decided yet, but I'd like to go to the beach if I get some time off."
  },
  {
    "japanese": "いいね。泳ぐのは好き？",
    "english": "Sounds good. Do you like swimming?"
  },
  {
    "japanese": "うん、泳ぐのは得意じゃないけど好きだよ。君は？",
    "english": "Yeah, I'm not great at it, but I like it. How about you?"
  },
  {
    "japanese": "僕も好きだよ。小さい頃からプールに通ってたんだ。",
    "english": "I like it too. I used to go to a swimming pool when I was little."
  },
  {
    "japanese": "それはいいね。もし時間が合えば一緒に行こうよ。",
    "english": "That's cool. We should go together if we have time."
  },
  {
    "japanese": "そうしよう！ ところで、兄弟はいるの？",
    "english": "Let's do it! By the way, do you have any siblings?"
  },
  {
    "japanese": "妹が一人いるよ。まだ中学生だけど、結構背が高いんだ。",
    "english": "I have a younger sister. She's still in junior high, but she's pretty tall."
  },
  {
    "japanese": "へえ、将来はバスケとかやるのかな？",
    "english": "Wow, maybe she'll play basketball in the future?"
  },
  {
    "japanese": "どうだろう。彼女は音楽に興味があるみたい。",
    "english": "I'm not sure. She seems more interested in music."
  },
  {
    "japanese": "なるほど。家族は仲がいい？",
    "english": "I see. Are you close with your family?"
  },
  {
    "japanese": "まあまあかな。週末は一緒にご飯を食べることが多いよ。",
    "english": "We're okay. We usually have meals together on weekends."
  },
  {
    "japanese": "いい習慣だね。僕の家は最近みんな忙しくてバラバラなんだ。",
    "english": "That's a good habit. My family has been busy lately, so we don't eat together much."
  },
  {
    "japanese": "そうなんだ。時間があるときに、家族で出かけるのも楽しいよ。",
    "english": "I see. It's fun to go out with your family when you have free time."
  },
  {
    "japanese": "うん、今度みんなで映画を見に行こうかと考えてる。",
    "english": "Yeah, I'm thinking about going to the movies with them soon."
  },
  {
    "japanese": "映画といえば、最近何か観た？",
    "english": "Speaking of movies, have you watched anything recently?"
  },
  {
    "japanese": "先週、新作のアクション映画を観たよ。面白かった！",
    "english": "I watched a new action movie last week. It was awesome!"
  },
  {
    "japanese": "いいね。どんなストーリーだった？",
    "english": "Nice. What was the story about?"
  },
  {
    "japanese": "主人公が世界を救うために戦うんだけど、コメディ要素もあって笑えたよ。",
    "english": "The main character fights to save the world, but there's some comedy in it, too. It was funny."
  },
  {
    "japanese": "ちょっと気になるな。僕も観ようかな。",
    "english": "I'm curious now. Maybe I'll check it out."
  },
  {
    "japanese": "うん、おすすめだよ。そうだ、観終わったら感想聞かせてね。",
    "english": "Yeah, I recommend it. Let me know what you think after you watch it."
  },
  {
    "japanese": "わかった。じゃあ週末に時間があれば観てみるね。",
    "english": "Sure. I'll watch it this weekend if I have time."
  },
  {
    "japanese": "OK、それじゃあまた連絡して！",
    "english": "Alright, hit me up later!"
  },
  {
    "japanese": "うん、またね。",
    "english": "Will do. See you!"
  }
],
      [ // Stage 4 (10問)
        {
          japanese: "私は毎朝7時に起きます。",
          english: "I wake up at 7 o'clock every morning.",
        },
        {
          japanese: "彼は毎週金曜日にテニスをします。",
          english: "He plays tennis every Friday.",
        },
        {
          japanese: "私たちは昨夜映画を見ました。",
          english: "We watched a movie last night.",
        },
        {
          japanese: "彼女は今、本を読んでいます。",
          english: "She is reading a book right now.",
        },
        {
          japanese: "私は次の月曜日に友達に会う予定です。",
          english: "I am going to meet my friend next Monday.",
        },
        {
          japanese: "彼らは学校にバスで行きます。",
          english: "They go to school by bus.",
        },
        {
          japanese: "私は新しいカメラを買いたいと思っています。",
          english: "I want to buy a new camera.",
        },
        {
          japanese: "私の兄は大学で数学を勉強しています。",
          english: "My brother studies mathematics at university.",
        },
        {
          japanese: "そのレストランは10時に閉まります。",
          english: "The restaurant closes at 10 o'clock.",
        },
        {
          japanese: "私はコーヒーより紅茶が好きです。",
          english: "I like tea more than coffee.",
        }
      ],
      [ // Stage 5 (10問)
        {
          japanese: "天気が良いので散歩に行きましょう。",
          english: "Since the weather is nice, let's go for a walk.",
        },
        {
          japanese: "次の電車は何時に出発しますか？",
          english: "What time does the next train leave?",
        },
        {
          japanese: "私は料理が得意ではありませんが、挑戦するのが好きです。",
          english: "I am not good at cooking, but I enjoy trying.",
        },
        {
          japanese: "彼女は日本語とフランス語を話すことができます。",
          english: "She can speak Japanese and French.",
        },
        {
          japanese: "私は明日の会議のために資料を準備しています。",
          english: "I am preparing materials for tomorrow's meeting.",
        },
        {
          japanese: "あの映画は評判が良いので、見る価値があります。",
          english: "That movie has a good reputation, so it's worth watching.",
        },
        {
          japanese: "この問題を解決するために、何か良いアイデアはありますか？",
          english: "Do you have any good ideas to solve this problem?",
        },
        {
          japanese: "私は将来、世界中を旅してみたいです。",
          english: "In the future, I would like to travel around the world.",
        },
        {
          japanese: "駅に行く最短の道を教えていただけますか？",
          english: "Can you tell me the shortest way to the station?",
        },
        {
          japanese: "彼はそのプロジェクトを成功させるために一生懸命働いています。",
          english: "He is working hard to make the project successful.",
        }
      ],
      [ // Stage 6 (10問)
        {
          japanese: "彼は新しい映画を見たことがありますか？",
          english: "Has he watched the new movie?",
        },
        {
          japanese: "あなたは最近何か面白い本を読みましたか？",
          english: "Have you read any interesting books lately?",
        },
        {
          japanese: "このプロジェクトは終わりそうにありません。",
          english: "This project doesn't seem like it will end.",
        },
        {
          japanese: "彼女はそのイベントに来る予定ですか？",
          english: "Is she coming to the event?",
        },
        {
          japanese: "私たちは彼のアイデアを完全に理解していません。",
          english: "We don’t fully understand his idea.",
        },
        {
          japanese: "あなたはその会議に参加する予定ですか？",
          english: "Are you planning to join the meeting?",
        },
        {
          japanese: "彼らはそのニュースについて知っていると思いますか？",
          english: "Do you think they know about the news?",
        },
        {
          japanese: "私は彼が言ったことを信じていません。",
          english: "I don’t believe what he said.",
        },
        {
          japanese: "彼女はこの町に住んでいますよね？",
          english: "She lives in this town, doesn’t she?",
        },
        {
          japanese: "これが最後のチャンスだと思いませんか？",
          english: "Don’t you think this is the last chance?",
        }
      ],
      [ // Stage 7 (10問)
        {
          japanese: "私は今朝からずっとこの問題に取り組んでいます。",
          english: "I have been working on this problem since this morning.",
        },
        {
          japanese: "彼女はその本を昨日読み終えました。",
          english: "She finished reading the book yesterday.",
        },
        {
          japanese: "彼らは次の週末に新しい家に引っ越す予定です。",
          english: "They are moving to a new house next weekend.",
        },
        {
          japanese: "私たちは来月旅行に行くつもりです。",
          english: "We are going to travel next month.",
        },
        {
          japanese: "私はすでに昼食を食べました。",
          english: "I have already had lunch.",
        },
        {
          japanese: "明日のこの時間、私はプレゼンテーションをしているでしょう。",
          english: "At this time tomorrow, I will be giving a presentation.",
        },
        {
          japanese: "彼はその本を5回も読んだことがあります。",
          english: "He has read that book five times.",
        },
        {
          japanese: "このプロジェクトは来週までには完了しているはずです。",
          english: "This project will have been completed by next week.",
        },
        {
          japanese: "彼女はずっとピアノを弾いています。",
          english: "She has been playing the piano.",
        },
        {
          japanese: "私は先週から新しい仕事を始めました。",
          english: "I started a new job last week.",
        }
      ],
      [ // Stage 8 (10問)
        {
          japanese: "もし私があなたなら、その仕事を引き受けます。",
          english: "If I were you, I would take the job.",
        },
        {
          japanese: "雨が降らなければ、ピクニックに行きましょう。",
          english: "If it doesn't rain, let's go for a picnic.",
        },
        {
          japanese: "もっと早く出発していれば、電車に間に合ったかもしれません。",
          english: "If we had left earlier, we might have caught the train.",
        },
        {
          japanese: "十分なお金があれば、その家を買いたいです。",
          english: "If I had enough money, I would buy that house.",
        },
        {
          japanese: "もっと時間があれば、旅行に行くのに。",
          english: "If I had more time, I would go on a trip.",
        },
        {
          japanese: "彼が手伝ってくれれば、もっと早く終わるでしょう。",
          english: "If he helps us, we will finish sooner.",
        },
        {
          japanese: "もし努力しなければ、目標を達成できません。",
          english: "If you don't make an effort, you can't achieve your goals.",
        },
        {
          japanese: "もっと勉強していたら、試験に合格していただろうに。",
          english: "If I had studied harder, I would have passed the exam.",
        },
        {
          japanese: "時間があれば手伝えるのに。",
          english: "If I had the time, I could help you.",
        },
        {
          japanese: "彼女が招待してくれたら、パーティーに行くでしょう。",
          english: "If she invites me, I will go to the party.",
        }
      ],
      [ // Stage 9 (10問)
        {
          japanese: "この本はあの本よりも面白いです。",
          english: "This book is more interesting than that one.",
        },
        {
          japanese: "彼はクラスで最も背が高い生徒です。",
          english: "He is the tallest student in the class.",
        },
        {
          japanese: "このコーヒーは紅茶よりも強い味がします。",
          english: "This coffee tastes stronger than tea.",
        },
        {
          japanese: "このレストランは町で一番人気があります。",
          english: "This restaurant is the most popular in town.",
        },
        {
          japanese: "今日の天気は昨日よりも暑いです。",
          english: "The weather today is hotter than yesterday.",
        },
        {
          japanese: "彼女の歌声は私の声よりも美しいです。",
          english: "Her singing voice is more beautiful than mine.",
        },
        {
          japanese: "この映画はこれまで見た中で最高の映画です。",
          english: "This is the best movie I have ever seen.",
        },
        {
          japanese: "彼は兄弟の中で一番速く走ることができます。",
          english: "He can run the fastest among his siblings.",
        },
        {
          japanese: "この問題は他のどの問題よりも難しいです。",
          english: "This problem is more difficult than any other problem.",
        },
        {
          japanese: "このホテルは街の他のホテルよりも高価です。",
          english: "This hotel is more expensive than other hotels in the city.",
        }
      ],
      [ // Stage 10 (10問)
        {
          japanese: "この部屋は毎日掃除されます。",
          english: "This room is cleaned every day.",
        },
        {
          japanese: "その手紙は昨日彼によって書かれました。",
          english: "The letter was written by him yesterday.",
        },
        {
          japanese: "この本は多くの学生に読まれています。",
          english: "This book is read by many students.",
        },
        {
          japanese: "新しいショッピングモールが建設されています。",
          english: "A new shopping mall is being built.",
        },
        {
          japanese: "そのプレゼントは彼女に渡されました。",
          english: "The gift was given to her.",
        },
        {
          japanese: "その家は去年売られました。",
          english: "The house was sold last year.",
        },
        {
          japanese: "この写真はプロのカメラマンによって撮影されました。",
          english: "This photo was taken by a professional photographer.",
        },
        {
          japanese: "その問題はまだ解決されていません。",
          english: "The issue has not been solved yet.",
        },
        {
          japanese: "この映画はたくさんの人に愛されています。",
          english: "This movie is loved by many people.",
        },
        {
          japanese: "新しいルールがすべての社員に通知されました。",
          english: "The new rules were announced to all employees.",
        }
      ],
      [ // Stage 11 (10問)
        {
          japanese: "これは私が昨日買った本です。",
          english: "This is the book that I bought yesterday.",
        },
        {
          japanese: "彼女が住んでいる家はとても大きいです。",
          english: "The house where she lives is very big.",
        },
        {
          japanese: "私が話した男性は医者です。",
          english: "The man whom I spoke to is a doctor.",
        },
        {
          japanese: "私が好きな映画は『インセプション』です。",
          english: "The movie that I like is 'Inception.'",
        },
        {
          japanese: "彼が働いている会社は有名です。",
          english: "The company where he works is famous.",
        },
        {
          japanese: "私たちが訪れた場所はとても美しかったです。",
          english: "The place we visited was very beautiful.",
        },
        {
          japanese: "これが彼女が作ったケーキです。",
          english: "This is the cake that she made.",
        },
        {
          japanese: "彼が昨日会った人々はとても親切でした。",
          english: "The people he met yesterday were very kind.",
        },
        {
          japanese: "彼が好きな色は青です。",
          english: "The color that he likes is blue.",
        },
        {
          japanese: "私が住んでいる街は静かです。",
          english: "The city where I live is quiet.",
        }
      ],
      [ // Stage 12 (おまけ: 命令文・感嘆文 10問)
        {
          japanese: "ドアを閉めてください。",
          english: "Please close the door.",
        },
        {
          japanese: "もっと早く来てください。",
          english: "Please come earlier.",
        },
        {
          japanese: "これを忘れないでください！",
          english: "Don't forget this!",
        },
        {
          japanese: "彼を助けてください。",
          english: "Help him, please.",
        },
        {
          japanese: "素晴らしい眺めですね！",
          english: "What a beautiful view!",
        },
        {
          japanese: "なんて素敵なドレスなんでしょう！",
          english: "What a lovely dress!",
        },
        {
          japanese: "それを今すぐやりなさい。",
          english: "Do it right now.",
        },
        {
          japanese: "もっと一生懸命頑張りなさい！",
          english: "Work harder!",
        },
        {
          japanese: "なんて面白い本なんだ！",
          english: "What an interesting book!",
        },
        {
          japanese: "静かにしてください！",
          english: "Be quiet, please!",
        }
      ],
      [ // Stage 13 (おまけ: 動名詞・不定詞 10問)
        {
          japanese: "私は早起きを楽しんでいます。",
          english: "I enjoy waking up early.",
        },
        {
          japanese: "彼は新しいスキルを学ぶことに興味があります。",
          english: "He is interested in learning new skills.",
        },
        {
          japanese: "あなたに会えてうれしいです。",
          english: "It's nice to meet you.",
        },
        {
          japanese: "彼女はピアノを弾く練習をしています。",
          english: "She is practicing playing the piano.",
        },
        {
          japanese: "私は旅行に行くのが好きです。",
          english: "I like going on trips.",
        },
        {
          japanese: "彼はその問題を解決しようとしています。",
          english: "He is trying to solve the problem.",
        },
        {
          japanese: "この本を読む価値があります。",
          english: "This book is worth reading.",
        },
        {
          japanese: "私は英語を話すことを改善したいです。",
          english: "I want to improve my English speaking.",
        },
        {
          japanese: "彼女は新しいプロジェクトを始めることを決めました。",
          english: "She decided to start a new project.",
        },
        {
          japanese: "車を運転することは難しいと思います。",
          english: "I think driving a car is difficult.",
        }
      ],
      [ // Stage 14 (おまけ: 接続詞 10問)
        {
          japanese: "私は外出したかったが、雨が降り始めた。",
          english: "I wanted to go out, but it started raining.",
        },
        {
          japanese: "彼は疲れていたので、早く寝ました。",
          english: "He was tired, so he went to bed early.",
        },
        {
          japanese: "私は家を出る前に朝食を食べました。",
          english: "I had breakfast before leaving the house.",
        },
        {
          japanese: "彼女は勉強を終えた後、友達と会いました。",
          english: "She met her friends after finishing her studies.",
        },
        {
          japanese: "もし雨が降ったら、ピクニックをキャンセルします。",
          english: "If it rains, we will cancel the picnic.",
        },
        {
          japanese: "私は英語が好きです、なぜならそれは面白いからです。",
          english: "I like English because it is interesting.",
        },
        {
          japanese: "あなたが忙しい間、私は待っています。",
          english: "While you are busy, I will wait.",
        },
        {
          japanese: "彼は一生懸命働いている一方で、休む時間をほとんど持っていません。",
          english: "Although he works hard, he has little time to rest.",
        },
        {
          japanese: "天気が良ければ、私たちはハイキングに行きます。",
          english: "We will go hiking as long as the weather is good.",
        },
        {
          japanese: "私は彼に会うためにパーティーに行きました。",
          english: "I went to the party so that I could meet him.",
        }
      ],
      [ // Stage 15 (おまけ: カジュアル表現 10問)
        {
          japanese: "ちょっと待って、すぐ戻るから。",
          english: "Hang on, I'll be right back.",
        },
        {
          japanese: "お腹が空いたね、何か食べようよ。",
          english: "I'm starving, let's grab something to eat.",
        },
        {
          japanese: "それ、本気で言ってるの？",
          english: "Are you serious?",
        },
        {
          japanese: "やばい、完全にそれ忘れてた！",
          english: "Oh no, I totally forgot about that!",
        },
        {
          japanese: "行くなら早くしよう！",
          english: "If we're going, let's hurry up!",
        },
        {
          japanese: "いい感じじゃない？",
          english: "Doesn't it look great?",
        },
        {
          japanese: "ちょっと考えさせて。",
          english: "Let me think about it.",
        },
        {
          japanese: "ちょっと待って、それはどういう意味？",
          english: "Wait a second, what do you mean by that?",
        },
        {
          japanese: "その映画、本当に最高だったよ。",
          english: "That movie was absolutely amazing.",
        },
        {
          japanese: "そんなに心配しなくていいよ。",
          english: "You don't need to worry so much.",
        }
      ],
      [ // Stage 16 (おまけ: カジュアル表現 続き 10問)
        {
          japanese: "ちょっと考えすぎじゃない？",
          english: "Aren't you overthinking it?",
        },
        {
          japanese: "それ、めちゃくちゃ面白いね！",
          english: "That's hilarious!",
        },
        {
          japanese: "気にしないで、忘れちゃいなよ。",
          english: "Don't worry about it, just let it go.",
        },
        {
          japanese: "まじで？本当にそれ言ったの？",
          english: "Seriously? Did you really say that?",
        },
        {
          japanese: "あとで連絡するから。",
          english: "I'll hit you up later.",
        },
        {
          japanese: "これ、めっちゃカッコいいじゃん！",
          english: "This is so cool!",
        },
        {
          japanese: "そんなに焦らなくていいよ。",
          english: "No need to rush.",
        },
        {
          japanese: "とりあえずやってみようよ。",
          english: "Let's just give it a try.",
        },
        {
          japanese: "なんてこった、信じられない！",
          english: "Oh my gosh, I can't believe it!",
        },
        {
          japanese: "まあ、そういうこともあるよね。",
          english: "Well, it happens.",
        }
      ]
    ];

    // JavaScriptの変数宣言をまとめてscriptタグの先頭に移動
    let currentStageIndex = 0; // 現在のステージ (0-オリジン)
    let currentSentenceIndex = 0; // 現在のステージ内の問題番号 (0-オリジン)
    let currentIndex = 0; // 次に正解すべき単語のインデックス
    let loadIndex = 0; // 次にボタンへ補充する未使用単語のインデックス
    let typedWords = []; // 正解済み単語
    let puzzleCompleted = false; // パズルが完了したかどうかを示すフラグ
    let buttonElements = []; // 「常時表示する5ボタン」用のDOM要素を保持する配列
    let displayWords = new Array(5).fill(null); // ボタンに表示中の単語を保持する配列

    // 画面上の要素取得
    const stageSelectButtonsDiv = document.getElementById("stage-select");
    const currentStageDisplay = document.getElementById("current-stage");
    const japaneseSentence = document.getElementById("japanese-sentence");
    const sentenceBox = document.getElementById("sentence-box");
    const wordButtons = document.getElementById("word-buttons");
    const feedback = document.getElementById("feedback");
    const hintButton = document.getElementById("hint-button");
    const nextButton = document.getElementById("next-button");
    const confettiContainer = document.getElementById("confetti-container");

    /**
     * 単語分割関数
     * 英語の文章を空白や句読点で分割して単語リストを生成する
     * @param {string} englishSentence - 分割する英語の文章
     * @returns {string[]} - 分割された単語の配列
     */
    function generateWordsFromEnglish(englishSentence) {
      // 空白・句読点などで分割
      const words = englishSentence.split(/([\s.,!?;":]+)/);
      // trimして不要要素を排除
      return words.map(w => w.trim()).filter(w => w !== "");
    }

    /**
     * ステージ選択ボタン初期化
     * ステージ数に応じてボタンを動的に生成し、イベントリスナーを設定する
     */
    function initStageSelectButtons() {
      stageSelectButtonsDiv.innerHTML = ""; // 既存のボタンをクリア
      for (let i = 0; i < stages.length; i++) {
        const stageButton = document.createElement("button");
        stageButton.textContent = i + 1; // Stage番号は1から
        stageButton.addEventListener("click", () => loadStage(i));
        stageSelectButtonsDiv.appendChild(stageButton);
      }
    }

    /**
     * ステージロード
     * 指定されたステージの問題をロードし、ゲームの状態を初期化する
     * @param {number} stageIndex - ロードするステージのインデックス (0-オリジン)
     */
    function loadStage(stageIndex) {
      if (stageIndex < 0 || stageIndex >= stages.length) {
        console.error("Invalid stage index:", stageIndex);
        return;
      }
      currentStageIndex = stageIndex;
      currentSentenceIndex = 0; // 最初の問題から
      updateCurrentStageDisplay();
      loadNewSentence();
    }

    /**
     * 現在のステージ表示を更新
     * 画面に現在のステージ番号を表示する
     */
    function updateCurrentStageDisplay() {
      currentStageDisplay.textContent = `ステージ ${currentStageIndex + 1}`;
    }

    /**
     * 新しい問題をロード
     * 現在のステージと問題番号に基づいて、新しい問題文と単語ボタンを生成する
     * パズルを初期状態に戻す
     */
    function loadNewSentence() {
      puzzleCompleted = false;
      feedback.textContent = "";
      feedback.style.color = "";
      hintButton.style.display = "inline-block";
      nextButton.style.display = "none";
      typedWords = [];
      currentIndex = 0;
      loadIndex = 0;
      displayWords = new Array(5).fill(null);

      const currentStageSentences = stages[currentStageIndex];
      if (!currentStageSentences || currentSentenceIndex >= currentStageSentences.length) {
        console.warn("No more sentences in stage:", currentStageIndex);
        feedback.textContent = "ステージクリア！おめでとうございます！";
        feedback.style.color = "green";
        hintButton.style.display = "none";
        nextButton.style.display = "none";
        // ステージクリア時は「次へ」ボタンも非表示
        return; // 問題が存在しない場合、処理を中断
      }

      const sentenceData = currentStageSentences[currentSentenceIndex];
      // 日本語文表示
      japaneseSentence.textContent = sentenceData.japanese;
      // 入力済み表示エリアを空に
      sentenceBox.textContent = "";
      // ボタンを初期化
      wordButtons.innerHTML = "";
      buttonElements = [];
      // 最初に「未使用単語」を最大5つ取り出して、まとめてシャッフルしてセット
      initDisplayWords();
      // 5つのボタンを作成して画面に表示
      for (let i = 0; i < 5; i++) {
        const btn = document.createElement("button");
        btn.classList.add("word");
        // displayWords[i] があればテキストを設定、なければ空
        if (displayWords[i]) {
          btn.textContent = displayWords[i];
        } else {
          // 文章の単語数が5未満の場合など
          btn.textContent = "";
          btn.style.visibility = "hidden"; // 空枠を隠す
        }
        // クリックイベント（どのボタンを押したかiでわかるように）
        btn.addEventListener("click", () => handleWordClick(i));
        wordButtons.appendChild(btn);
        buttonElements.push(btn);
      }
    }

    /**
     * 初期表示する5単語をシャッフルして displayWords にセット
     * 問題文の単語リストから未使用の単語を最大5つ抽出し、シャッフルしてボタンに表示する単語リスト `displayWords` を初期化する。
     */
    function initDisplayWords() {
      const sentenceData = stages[currentStageIndex][currentSentenceIndex];
      const expectedWords = sentenceData.words;
      // 未使用単語があれば最大5個取り出す
      const chunk = [];
      for (let i = 0; i < 5; i++) {
        if (loadIndex < expectedWords.length) {
          chunk.push(expectedWords[loadIndex]);
          loadIndex++;
        }
      }
      // chunkをシャッフル
      const shuffled = shuffleArray(chunk);
      // displayWords 配列に代入
      for (let i = 0; i < shuffled.length; i++) {
        displayWords[i] = shuffled[i];
      }
      // 残り部分は null (fill済み)
    }

    /**
     * 単語ボタンクリック時の処理
     * クリックされた単語が正解かどうかを判定し、フィードバックを表示、
     * 正解であれば次の単語へ、不正解であればエラーメッセージを表示する
     * @param {number} btnIndex - クリックされたボタンのインデックス
     */
    function handleWordClick(btnIndex) {
      if (puzzleCompleted) return;

      const sentenceData = stages[currentStageIndex][currentSentenceIndex];
      const expectedWords = sentenceData.words;
      // 今正解が必要な単語
      const correctWord = expectedWords[currentIndex];
      // ユーザーがクリックした単語
      const clickedWord = displayWords[btnIndex];

      if (!clickedWord) return; // ボタンが空の場合など

      if (clickedWord === correctWord) {
        // 正解
        typedWords.push(clickedWord);
        currentIndex++;
        updateSentenceBox();
        feedback.textContent = "";
        feedback.style.color = "";

        // ボタン置き換え
        // まだ未使用の単語が残っているなら、それをこのボタンにセットする
        if (loadIndex < expectedWords.length) {
          const newWord = expectedWords[loadIndex];
          loadIndex++;
          displayWords[btnIndex] = newWord;
          buttonElements[btnIndex].textContent = newWord;
        } else {
          // もう残りの単語がない場合は、 にして無効化する
          displayWords[btnIndex] = null;
          buttonElements[btnIndex].textContent = " ";
          buttonElements[btnIndex].disabled = true;
          buttonElements[btnIndex].classList.add("used-up");
        }

        // 全部の単語を使い切ったらクリア判定
        if (currentIndex >= expectedWords.length) {
          puzzleCompleted = true;
          feedback.textContent = "正解です！おめでとう！";
          feedback.style.color = "green";
          hintButton.style.display = "none";
          nextButton.style.display = "inline-block";
          showConfetti();
        }
      } else {
        // 不正解
        feedback.textContent = "間違っています。";
        feedback.style.color = "red";
      }
    }

    /**
     * 次の問題へ進む
     * 問題番号をインクリメントし、次の問題をロードする。
     * ステージ内のすべての問題をクリアした場合、ステージクリアメッセージを表示する。
     */
    function loadNextSentence() {
      currentSentenceIndex++; // 問題番号をインクリメント
      if (currentSentenceIndex >= stages[currentStageIndex].length) {
        // ステージ内の問題をすべてクリアした場合
        feedback.textContent = "ステージクリア！おめでとうございます！";
        feedback.style.color = "green";
        hintButton.style.display = "none";
        nextButton.style.display = "none";
        // ステージクリア時は「次へ」ボタンも非表示
        showConfetti(); // ステージクリアの紙吹雪
      } else {
        // 次の問題をロード
        loadNewSentence();
      }
    }

    /**
     * ヒント表示
     * 現在解答すべき単語のヒントをフィードバックエリアに表示する
     */
    function showHint() {
      if (puzzleCompleted) return;

      const sentenceData = stages[currentStageIndex][currentSentenceIndex];
      const expectedWords = sentenceData.words;
      if (currentIndex < expectedWords.length) {
        const nextWord = expectedWords[currentIndex];
        feedback.textContent = `ヒント: 次の単語は "${nextWord}" です。`;
        feedback.style.color = "blue";
      }
    }

    /**
     * 入力済み単語の表示を更新
     * sentenceBoxに現在までに入力された単語を結合して表示する
     */
    function updateSentenceBox() {
      sentenceBox.textContent = typedWords.join(" ");
    }

    /**
     * 紙吹雪アニメーション表示
     * 画面全体に紙吹雪のアニメーションを表示し、ステージクリアやパズルクリアを祝う演出を行う
     */
    function showConfetti() {
      confettiContainer.innerHTML = "";
      for (let i = 0; i < 50; i++) {
        const piece = document.createElement("div");
        piece.classList.add("confetti-piece");
        piece.style.backgroundColor = getRandomColor();
        piece.style.left = `${Math.random() * 100}vw`;
        piece.style.animationDelay = `${Math.random()}s`;
        piece.style.animationDuration = `${2 + Math.random() * 3}s`;
        confettiContainer.appendChild(piece);
      }
      confettiContainer.style.display = "block";
      setTimeout(() => {
        confettiContainer.style.display = "none";
      }, 4000);
    }

    /**
     * ランダムな色を生成
     * 紙吹雪の色をランダムに生成するために使用する
     * @returns {string} - ランダムな色のHEXコード
     */
    function getRandomColor() {
      const colors = ["#fce18a", "#ff726d", "#b48def", "#f7cac9", "#88d8b0"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    /**
     * 配列シャッフル関数
     * Fisher-Yatesアルゴリズムを用いて配列の要素をランダムにシャッフルする
     * @param {Array} array - シャッフルする配列
     * @returns {Array} - シャッフルされた新しい配列
     */
    function shuffleArray(array) {
      const arr = array.slice(); // 元の配列を破壊しないようにコピーを作成
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]]; // 要素の入れ替え
      }
      return arr;
    }

    // 全部の文に対して分割単語を付与
    stages.forEach(stageSentences => {
      stageSentences.forEach(sentence => {
        sentence.words = generateWordsFromEnglish(sentence.english);
      });
    });

    // イベントリスナーの設定
    nextButton.addEventListener("click", loadNextSentence);
    hintButton.addEventListener("click", showHint);

    // 初期化処理
    initStageSelectButtons(); // ステージ選択ボタン初期化
    loadStage(0); // 初期ステージロード (ステージ1から)

  </script>
</body>

</html>
